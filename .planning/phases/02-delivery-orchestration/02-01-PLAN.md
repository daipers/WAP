---
phase: 02-delivery-orchestration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dev_package/src/delivery_service/models.py
  - dev_package/src/delivery_service/test_assembly.py
  - dev_package/src/delivery_service/__init__.py
autonomous: true

must_haves:
  truths:
    - "User can create test definitions with sections from item bank"
    - "User can configure item selection rules (random, fixed, adaptive)"
    - "User can define ordering (sequential, random, shuffle)"
    - "User can set time limits, navigation mode, and attempt limits"
  artifacts:
    - path: "dev_package/src/delivery_service/models.py"
      provides: "SQLAlchemy models for AssessmentDefinition, SectionConfig, SelectionRule"
      contains: "class AssessmentDefinition"
    - path: "dev_package/src/delivery_service/test_assembly.py"
      provides: "Test assembly service with item selection and ordering"
      exports: ["TestAssemblyService", "SelectionMode", "OrderMode"]
    - path: "dev_package/src/delivery_service/__init__.py"
      provides: "Module exports"
  key_links:
    - from: "test_assembly.py"
      to: "content_bank_service.content_bank"
      via: "import ContentBankService"
      pattern: "content_bank_service.*ContentBankService"
---

<objective>
Build test assembly service that allows users to construct assessments from the item bank with configurable sections, selection rules, and delivery parameters.
</objective>

<tasks>

<task type="auto">
  <name>Create delivery service models</name>
  <files>dev_package/src/delivery_service/models.py</files>
  <action>
Create SQLAlchemy-style models (dataclasses for in-memory persistence) for:
- AssessmentDefinition: assessment_id, title, sections (list), time_limit_seconds, attempt_limit, navigation_mode, created_at
- SectionConfig: section_id, name, item_pool_ids, selection_mode, items_to_select, order_mode, time_limit_seconds
- SelectionRule: rule_type (random, fixed, adaptive), parameters
- NavigationMode: LINEAR, NON_LINEAR, HYBRID enum

Use existing patterns from content_bank_service/models.py (dataclass-based with metadata).
  </action>
  <verify>File exists with all dataclasses defined and importable</verify>
  <done>AssessmentDefinition, SectionConfig, SelectionRule, NavigationMode dataclasses exist and can be instantiated</done>
</task>

<task type="auto">
  <name>Implement test assembly service</name>
  <files>dev_package/src/delivery_service/test_assembly.py</files>
  <action>
Create TestAssemblyService that:
- Accepts AssessmentDefinition and ContentBankService reference
- select_items(config, available_items): implements RANDOM, FIXED, ADAPTIVE selection modes
- order_items(items, mode): implements SEQUENTIAL, RANDOM, SHUFFLE_SECTIONS ordering
- build_test(assessment_id): assembles full test with selected/ordered items
- validate_assessment(definition): ensures all referenced items exist in content bank

Import SelectionMode and OrderMode enums from models. Use ContentBankService.get_item() to validate item existence.
  </action>
  <verify>TestAssemblyService can assemble a test from mock items</verify>
  <done>TestAssemblyService.select_items() and order_items() return correct item lists based on config</done>
</task>

<task type="auto">
  <name>Create delivery service module exports</name>
  <files>dev_package/src/delivery_service/__init__.py</files>
  <action>
Create __init__.py that exports:
- AssessmentDefinition, SectionConfig, SelectionRule, NavigationMode from models
- SelectionMode, OrderMode from models
- TestAssemblyService from test_assembly
- AssessmentSession (placeholder for now) from models
  </action>
  <verify>import delivery_service returns all expected exports</verify>
  <done>All public APIs exported from delivery_service module</done>
</task>

</tasks>

<verification>
- Can create AssessmentDefinition with multiple sections
- Can select items using RANDOM mode returns correct count
- Can order items using RANDOM mode shuffles order
- Validation fails gracefully when items don't exist
</verification>

<success_criteria>
User can create test definitions with sections, selection rules, and ordering; items are correctly selected from content bank based on configuration.
</success_criteria>

<output>
After completion, create `.planning/phases/02-delivery-orchestration/02-01-SUMMARY.md`
</output>
